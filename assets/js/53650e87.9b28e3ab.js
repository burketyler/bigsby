"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[649],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return u}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),h=p(n),u=i,m=h["".concat(s,".").concat(u)]||h[u]||d[u]||r;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},5342:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return d}});var a=n(3117),i=n(102),r=(n(7294),n(3905)),o=["components"],l={},s="Lifecycle",p={unversionedId:"usage/lifecycle",id:"usage/lifecycle",title:"Lifecycle",description:"The Bigsby request lifecycle is composed of a number of stages that revolve around validation, parsing,",source:"@site/docs/usage/lifecycle.mdx",sourceDirName:"usage",slug:"/usage/lifecycle",permalink:"/bigsby/docs/usage/lifecycle",tags:[],version:"current",frontMatter:{},sidebar:"docs",previous:{title:"Authentication",permalink:"/bigsby/docs/usage/authentication"},next:{title:"Plugins",permalink:"/bigsby/docs/usage/plugins"}},c={},d=[{value:"Hooks",id:"hooks",level:2},{value:"onInit",id:"oninit",level:3},{value:"preInvoke",id:"preinvoke",level:3},{value:"preAuth",id:"preauth",level:3},{value:"onAuthFail",id:"onauthfail",level:3},{value:"preValidate",id:"prevalidate",level:3},{value:"preParse",id:"preparse",level:3},{value:"onRequestInvalid",id:"onrequestinvalid",level:3},{value:"preExecute",id:"preexecute",level:3},{value:"preResponse",id:"preresponse",level:3},{value:"onResponseInvalid",id:"onresponseinvalid",level:3},{value:"onError",id:"onerror",level:3},{value:"Response Takeover",id:"response-takeover",level:2}],h={toc:d};function u(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"lifecycle"},"Lifecycle"),(0,r.kt)("p",null,"The Bigsby request lifecycle is composed of a number of stages that revolve around validation, parsing,\nauthentication, execution and error handling."),(0,r.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,r.kt)("a",{href:"/bigsby/img/request-lifecycle-diagram.png",target:"_blank"},(0,r.kt)("img",{src:"/bigsby/img/request-lifecycle-diagram.png",alt:"Request Lifecycle"}))),(0,r.kt)("h2",{id:"hooks"},"Hooks"),(0,r.kt)("p",null,"Bigsby exposes hooks that enable the creation of complex and powerful request workflows. Each hook accepts\nan array of functions known as ",(0,r.kt)("inlineCode",{parentName:"p"},"HookChains"),". Hooks can be used to perform special startup or shutdown operations,\ntransform request/response payloads, or add metadata to the ",(0,r.kt)("inlineCode",{parentName:"p"},"RequestContext"),". Many hooks can even be used to\n",(0,r.kt)("a",{parentName:"p",href:"#response-takeover"},"takeover")," the ",(0,r.kt)("inlineCode",{parentName:"p"},"ApiResponse")," a handler returns."),(0,r.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"All hooks are asynchronous, they're called in the order they appear in the input array, and they receive the\n",(0,r.kt)("inlineCode",{parentName:"p"},"RequestContext")," of the invocation (some hooks may receive additional inputs too, see below)."))),(0,r.kt)("h3",{id:"oninit"},"onInit"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"onInit")," hook chain is called a single time when the Lambda handler instance is first invoked, before any\nother stage in the lifecycle. It receives the Bigsby instance the hook is registered; it cannot takeover the response."),(0,r.kt)("h3",{id:"preinvoke"},"preInvoke"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"preInvoke")," hook chain is called before any other stage in the lifecycle, on each invocation of the handler."),(0,r.kt)("h3",{id:"preauth"},"preAuth"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"preAuth")," hook chain is called immediately prior to any ",(0,r.kt)("a",{parentName:"p",href:"/bigsby/docs/usage/authentication#authenticators"},"authenticator")," or\n",(0,r.kt)("a",{parentName:"p",href:"/bigsby/docs/usage/authentication#auth-scheme"},"AuthScheme")," attached to a handler. If no authentication is attached to the handler,\nit won't be called."),(0,r.kt)("h3",{id:"onauthfail"},"onAuthFail"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"onAuthFail")," hook chain is called when a request fails authentication. In addition to the request context,\nit receives the ",(0,r.kt)("a",{parentName:"p",href:"/bigsby/docs/usage/authentication#denying-a-request"},"Error")," thrown by the authenticator."),(0,r.kt)("h3",{id:"prevalidate"},"preValidate"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"preValidate")," hook chain is called immediately prior to request ",(0,r.kt)("a",{parentName:"p",href:"/bigsby/docs/usage/validation#request"},"validation"),". If no request\nvalidation is attached to the handler, it won't be called."),(0,r.kt)("h3",{id:"preparse"},"preParse"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"preParse")," hook chain is called immediately prior to processing the incoming API Gateway event payload, including\nthe execution of any ",(0,r.kt)("a",{parentName:"p",href:"/bigsby/docs/usage/event-parsing"},"event parsing")," instructions."),(0,r.kt)("h3",{id:"onrequestinvalid"},"onRequestInvalid"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"onRequestInvalid")," hook chain is called in two scenarios:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The Joi request schema validation fails."),(0,r.kt)("li",{parentName:"ul"},"An error occurred when Bigsby attempted to parse the incoming API Gateway event.")),(0,r.kt)("p",null,"In addition to the request context, the hook receives either the ",(0,r.kt)("a",{parentName:"p",href:"https://joi.dev/api/?v=17.6.0#validationerror"},"ValidationError"),"\nreturned by Joi, or the ",(0,r.kt)("inlineCode",{parentName:"p"},"RequestParseError")," generated by Bigsby."),(0,r.kt)("h3",{id:"preexecute"},"preExecute"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"preExecute")," hook chain is called immediately prior to the invoke method of the handler class being called."),(0,r.kt)("h3",{id:"preresponse"},"preResponse"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"preResponse")," hook chain is called immediately prior to Bigsby returning a response, during an invocation\nthat is returning normally. In addition to the request context, it receives the ",(0,r.kt)("inlineCode",{parentName:"p"},"ApiResponse")," object representing\nthe outgoing response."),(0,r.kt)("h3",{id:"onresponseinvalid"},"onResponseInvalid"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"onResponseInvalid")," hook chain is called in two scenarios:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The Joi response schema validation fails."),(0,r.kt)("li",{parentName:"ul"},"An error occurred when Bigsby attempted to create the ",(0,r.kt)("inlineCode",{parentName:"li"},"ApiResponse")," from the handler's return value.")),(0,r.kt)("p",null,"In addition to the request context, the hook receives either the ",(0,r.kt)("a",{parentName:"p",href:"https://joi.dev/api/?v=17.6.0#validationerror"},"ValidationError"),"\nreturned by Joi, or the ",(0,r.kt)("inlineCode",{parentName:"p"},"TypeCoercionError")," generated by Bigsby."),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Response schema validation errors are considered internal errors because they indicate a breaking change to the response contract.\nBigsby errors during creation of an ",(0,r.kt)("inlineCode",{parentName:"p"},"ApiResponse")," are also considered internal errors. Because of this, the ",(0,r.kt)("a",{parentName:"p",href:"#onerror"},"onError"),"\nhook will be called after ",(0,r.kt)("inlineCode",{parentName:"p"},"onResponseInvalid"),"."))),(0,r.kt)("h3",{id:"onerror"},"onError"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"onError")," hook chain is called when an unhandled exception occurs during the execution of the handler, or while\ncalling any hook chain that isn't expected to throw an error."),(0,r.kt)("h2",{id:"response-takeover"},"Response Takeover"),(0,r.kt)("p",null,"Hooks (except ",(0,r.kt)("a",{parentName:"p",href:"#oninit"},"onInit"),") can 'takeover' a handler's response by optionally returning an ",(0,r.kt)("inlineCode",{parentName:"p"},"ApiResponse"),". If this occurs,\nthe handler will discontinue the request lifecycle and instead immediately return the response following the completion\nof the hook chain. Each hook in the chain will receive the original inputs, plus a ",(0,r.kt)("inlineCode",{parentName:"p"},"ResponseBuilder")," representing the ",(0,r.kt)("inlineCode",{parentName:"p"},"ApiResponse"),"\nreturned by the previous hook in the chain, or undefined."))}u.isMDXComponent=!0}}]);